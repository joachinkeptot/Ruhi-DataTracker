<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RoomMap Ops</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app">
      <main class="layout">
        <section class="panel panel--full">
          <div class="panel__section board__header">
            <div class="tabs" role="tablist">
              <button class="tab tab--active" data-view="areas" role="tab">
                Areas
              </button>
              <button class="tab" data-view="cohorts" role="tab">
                Cohorts
              </button>
              <button class="tab" data-view="activities" role="tab">
                Activities
              </button>
            </div>
            <div class="board__actions">
              <button
                id="cohortViewToggle"
                class="btn btn--sm"
                style="display: none"
              >
                View: Categories
              </button>
              <input
                id="searchInput"
                type="text"
                placeholder="Search..."
                class="search-input"
              />
              <div id="roomStats" class="stats"></div>
              <button id="addItemBtn" class="fab" aria-label="Add">+</button>
            </div>
          </div>

          <div class="panel__section filter-section">
            <button id="filterToggle" class="btn btn--sm" type="button">
              ⏷ Filters
            </button>
            <div id="filterBar" class="filter-bar hidden">
              <div class="filter-row">
                <div class="filter-group">
                  <label class="muted" for="filterArea">Area</label>
                  <select id="filterArea">
                    <option value="">All</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label class="muted" for="filterCategory">Category</label>
                  <select id="filterCategory">
                    <option value="">All</option>
                    <option value="JY">JY</option>
                    <option value="CC">CC</option>
                    <option value="Youth">Youth</option>
                    <option value="Parents">Parents</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label class="muted" for="filterActivityType"
                    >Activity Type</label
                  >
                  <select id="filterActivityType">
                    <option value="">All</option>
                    <option value="JY">JY</option>
                    <option value="CC">CC</option>
                    <option value="StudyCircle">Study Circle</option>
                    <option value="Devotional">Devotional</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label class="muted" for="filterRuhiMin">Ruhi Level</label>
                  <div style="display: flex; gap: 0.25rem; align-items: center">
                    <input
                      id="filterRuhiMin"
                      type="number"
                      min="0"
                      max="12"
                      placeholder="Min"
                      class="filter-input"
                    />
                    <span class="muted">–</span>
                    <input
                      id="filterRuhiMax"
                      type="number"
                      min="0"
                      max="12"
                      placeholder="Max"
                      class="filter-input"
                    />
                  </div>
                </div>
                <div class="filter-group">
                  <label class="muted" for="filterJYText">JY Text</label>
                  <select id="filterJYText">
                    <option value="">All</option>
                    <option value="Book 1">Book 1</option>
                    <option value="Book 2">Book 2</option>
                    <option value="Book 3">Book 3</option>
                    <option value="Book 4">Book 4</option>
                    <option value="Book 5">Book 5</option>
                    <option value="Book 6">Book 6</option>
                    <option value="Book 7">Book 7</option>
                  </select>
                </div>
              </div>
              <button id="clearFilters" class="btn btn--sm" type="button">
                Clear All
              </button>
            </div>
          </div>

          <div class="panel__section">
            <div class="canvas-wrapper">
              <div id="canvas" class="canvas"></div>
            </div>
            <p class="hint">
              Drag nodes to move. Click to view details. Scroll to explore the
              infinite canvas.
            </p>
          </div>

          <div class="panel__section">
            <h2>Details</h2>
            <div id="detailPanel" class="detail">
              Select a node to see details.
            </div>
            <div id="statsBreakdown" class="stats-breakdown hidden">
              <h4>Statistics</h4>
              <div id="statsContent"></div>
            </div>
            <div class="legend">
              <span class="legend__title">Categories</span>
              <span class="legend__item legend__item--jy">JY</span>
              <span class="legend__item legend__item--cc">CC</span>
              <span class="legend__item legend__item--youth">Youth</span>
              <span class="legend__item legend__item--parents">Parents</span>
            </div>
          </div>

          <div class="panel__section">
            <h2>Tools</h2>
            <div class="form-row">
              <button id="exportRoomCsv" class="btn">Export People CSV</button>
              <button id="exportAllJson" class="btn">Export All JSON</button>
            </div>
            <div class="form-row">
              <input id="importFile" type="file" accept=".json,.csv" />
            </div>
            <p class="hint">
              CSV columns: name, area, note, categories, connectedActivities,
              jyTexts, studyCircleBooks, ruhiLevel, familyId, familyName,
              ageGroup, schoolName, employmentStatus, participationStatus
            </p>
          </div>
        </section>
      </main>
    </div>

    <div id="itemModal" class="modal hidden">
      <div class="modal__content">
        <h3>Add item</h3>
        <form id="itemForm">
          <div class="form-row">
            <label class="muted" for="itemType">Type</label>
            <select id="itemType">
              <option value="people">Person</option>
              <option value="activities">Activity</option>
            </select>
          </div>
          <div class="form-row">
            <input id="itemName" type="text" placeholder="Name" required />
          </div>
          <div id="peopleFields">
            <div class="form-row">
              <input id="itemArea" type="text" placeholder="Area" />
            </div>

            <div class="form-row">
              <label class="muted" for="familySelect">Family</label>
              <select id="familySelect">
                <option value="">No Family</option>
                <!-- Dynamically populated with families -->
              </select>
            </div>

            <div class="form-row">
              <label class="muted" for="ageGroup">Age Group</label>
              <select id="ageGroup">
                <option value="child">Child</option>
                <option value="JY">JY</option>
                <option value="youth">Youth</option>
                <option value="adult" selected>Adult</option>
                <option value="elder">Elder</option>
              </select>
            </div>

            <div class="form-row">
              <label class="muted" for="schoolName"
                >School Name (optional)</label
              >
              <input id="schoolName" type="text" placeholder="School name" />
            </div>

            <div class="form-row">
              <label class="muted" for="employmentStatus"
                >Employment Status</label
              >
              <select id="employmentStatus">
                <option value="student">Student</option>
                <option value="employed" selected>Employed</option>
                <option value="unemployed">Unemployed</option>
                <option value="retired">Retired</option>
              </select>
            </div>

            <div class="form-row">
              <label class="muted" for="participationStatus"
                >Participation Status</label
              >
              <select id="participationStatus">
                <option value="active" selected>Active</option>
                <option value="occasional">Occasional</option>
                <option value="lapsed">Lapsed</option>
                <option value="new">New</option>
              </select>
            </div>

            <div class="chips">
              <label><input type="checkbox" value="JY" /> JY</label>
              <label><input type="checkbox" value="CC" /> CC</label>
              <label><input type="checkbox" value="Youth" /> Youth</label>
              <label><input type="checkbox" value="Parents" /> Parents</label>
            </div>

            <!-- New fields for person -->
            <div class="form-row">
              <label class="muted" for="connectedActivities"
                >Connected Activities</label
              >
              <select id="connectedActivities" multiple size="3">
                <!-- Dynamically populated with activities -->
              </select>
              <small class="hint">Hold Ctrl/Cmd to select multiple</small>
            </div>

            <div class="form-row">
              <label class="muted">JY Texts Completed</label>
              <div class="chips">
                <label
                  ><input type="checkbox" class="jy-text-cb" value="Book 1" />
                  Book 1</label
                >
                <label
                  ><input type="checkbox" class="jy-text-cb" value="Book 2" />
                  Book 2</label
                >
                <label
                  ><input type="checkbox" class="jy-text-cb" value="Book 3" />
                  Book 3</label
                >
                <label
                  ><input type="checkbox" class="jy-text-cb" value="Book 4" />
                  Book 4</label
                >
                <label
                  ><input type="checkbox" class="jy-text-cb" value="Book 5" />
                  Book 5</label
                >
                <label
                  ><input type="checkbox" class="jy-text-cb" value="Book 6" />
                  Book 6</label
                >
                <label
                  ><input type="checkbox" class="jy-text-cb" value="Book 7" />
                  Book 7</label
                >
              </div>
            </div>

            <div class="form-row">
              <label class="muted" for="studyCircleBooks"
                >Study Circle Books</label
              >
              <textarea
                id="studyCircleBooks"
                rows="2"
                placeholder="e.g., Ruhi Book 1, Book 2"
              ></textarea>
            </div>

            <div class="form-row">
              <label class="muted" for="ruhiLevel">Ruhi Level</label>
              <input
                id="ruhiLevel"
                type="number"
                min="0"
                max="12"
                placeholder="0-12"
              />
            </div>
          </div>
          <div id="activityFields" class="hidden">
            <div class="form-row">
              <label class="muted" for="activityType">Activity Type</label>
              <select id="activityType">
                <option value="">Select type...</option>
                <option value="JY">JY</option>
                <option value="CC">CC</option>
                <option value="StudyCircle">Study Circle</option>
                <option value="Devotional">Devotional</option>
              </select>
            </div>
            <div id="jyFields" class="form-row hidden">
              <input
                id="animatorField"
                type="text"
                placeholder="Animator name"
              />
            </div>
            <div id="ccFields" class="form-row hidden">
              <input id="teacherField" type="text" placeholder="Teacher name" />
            </div>
            <div id="studyCircleFields" class="form-row hidden">
              <input id="tutorField" type="text" placeholder="Tutor name" />
            </div>
            <div id="devotionalFields" class="form-row hidden">
              <input
                id="leaderField"
                type="text"
                placeholder="Devotional leader name"
              />
            </div>
          </div>
          <div class="form-row">
            <input id="itemNote" type="text" placeholder="Notes (optional)" />
          </div>
          <div class="modal__actions">
            <button id="modalCancel" class="btn" type="button">Cancel</button>
            <button id="modalSave" class="btn btn--primary" type="submit">
              Add
            </button>
          </div>
        </form>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>
